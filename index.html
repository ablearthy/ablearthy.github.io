<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <script src="https://vk.com/js/api/openapi.js?168"></script>
    <script>
        if( typeof Element.prototype.clearChildren === 'undefined' ) {
            Object.defineProperty(Element.prototype, 'clearChildren', {
              configurable: true,
              enumerable: false,
              value: function() {
                while(this.firstChild) this.removeChild(this.lastChild);
              }
            });
        }
        function render(divId, ownerId, postId, hash) {
            const width = (window.innerWidth < 768) ? window.innerWidth : ((window.innerWidth > 1080) ? window.innerWidth / 2: window.innerWidth * -0.15 + 886);
            window.VK && VK.Widgets && VK.Widgets.Post && VK.Widgets.Post(divId, ownerId, postId, hash, {width: width}) || setTimeout(render, Math.random() * 1000, divId, ownerId, postId, hash);
        }
        function root() {
            return {
                themeId: 0,
                mType: "most_liked",
                data: {},
                position: 0,
                onChange: function () {
                    console.log('change', this.themeId, this.mType);
                    this.position = 0;
                    var root = document.getElementById("posts");
                    root.clearChildren();
                    this.fetch(this.themeId, this.mType);
                },
                onInit: function() {
                    this.data = await fetch("/data.json").then(r => r.json());
                    this.fetch();
                },
                fetch: function() {
                    console.log(this.data);
                    var posts = this.data[this.themeId][this.mType];
                    var root = document.getElementById("posts");
                    for (var post of posts.slice(this.position, this.position + 10)) {
                        var d = post.split('|');
                        var ownerId = parseInt(d[0]);
                        var postId = parseInt(d[1]);
                        var postHash = d[2];
                        var el = document.createElement("div");
                        el.id = `vk_post_${ownerId}_${postId}`;
                        el.classList.toggle('vk_post');
                        root.appendChild(el);
                        render(el.id, ownerId, postId, postHash);
                    }
                }
            }
        }
    </script>
</head>
<body >
    <div id="root" x-data="root()" x-init="onInit()" @scroll.window="if (Math.abs(window.pageYOffset + window.innerHeight - document.body.scrollHeight) < 300 ) {position += 10; fetch();}">
        <div class="options" >
            <select name="theme" id="theme" x-model="themeId" @change="onChange()">
                <option value="0">–í—Å–µ</option>
                <option value="2271">–ê–≤—Ç–æ, –º–æ—Ç–æ</option>
                <option value="2137">–ë—ã—Ç–æ–≤—ã–µ —É—Å–ª—É–≥–∏</option>
                <option value="2003">–ì–æ—Ä–æ–¥–∞, —Å—Ç—Ä–∞–Ω—ã</option>
                <option value="2005">–î–æ–º, —Ä–µ–º–æ–Ω—Ç</option>
                <option value="2274">–ñ–∏–≤–æ—Ç–Ω—ã–µ</option>
                <option value="2140">–ò–Ω—Ç–µ—Ä–Ω–µ—Ç</option>
                <option value="2136">–ö—Ä–∞—Å–æ—Ç–∞, –∑–¥–æ—Ä–æ–≤—å–µ</option>
                <option value="2002">–ö—É–ª–∏–Ω–∞—Ä–∏—è, —Ä–µ—Ü–µ–ø—Ç—ã</option>
                <option value="2127">–ö—É–ª—å—Ç—É—Ä–∞, –∏—Å–∫—É—Å—Å—Ç–≤–æ</option>
                <option value="2273">–ú–µ–¥–∏—Ü–∏–Ω–∞</option>
                <option value="2009">–ú—É–∑—ã–∫–∞</option>
                <option value="2129">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                <option value="2012">–û—Ç–Ω–æ—à–µ–Ω–∏—è, —Å–µ–º—å—è</option>
                <option value="2131">–ü–µ—Ä—Å–æ–Ω–∞</option>
                <option value="2013">–ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç—ã</option>
                <option value="2133">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏</option>
                <option value="2134">–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
                <option value="2135">–†–µ—Å—Ç–æ—Ä–∞–Ω—ã</option>
                <option value="2126">–°–ú–ò</option>
                <option value="2130">–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</option>
                <option value="2144">–°–ø–æ—Ä—Ç</option>
                <option value="2132">–¢–æ–≤–∞—Ä—ã, –º–∞–≥–∞–∑–∏–Ω—ã</option>
                <option value="2138">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —É—Å–ª—É–≥–∏</option>
                <option value="2143">–¢—É—Ä–∏–∑–º –∏ –æ—Ç–¥—ã—Ö</option>
                <option value="2008">–£–≤–ª–µ—á–µ–Ω–∏—è –∏ —Ö–æ–±–±–∏</option>
                <option value="2141">–£—Å–ª—É–≥–∏ —Å–≤—è–∑–∏</option>
                <option value="2142">–§–∏–Ω–∞–Ω—Å—ã –∏ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ</option>
                <option value="3268">–≠—Ä–æ—Ç–∏–∫–∞</option>
            </select>
            <select name="growth_type" id="growth_type" x-model="mType" @change="onChange()">
                <option value="most_liked">üîù –õ–∞–π–∫–∏</option>
                <option value="most_viewed">üîù –ü—Ä–æ—Å–º–æ—Ç—Ä—ã</option>
                <option value="growth_views">üìà –ü—Ä–æ—Å–º–æ—Ç—Ä—ã</option>
                <option value="growth_likes">üìà –õ–∞–π–∫–∏</option>
            </select>
        </div>
        <div id="posts">
        </div>
    </div>
</body>
<style>
    .options {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    #posts {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    #posts > div.vk_post {
        margin-top: 10px;
        margin-bottom: 10px;
    }
</style>
</html>
